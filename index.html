<!DOCTYPE html>

<html>
<head>
    <title>CS 3300 Project 1</title>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="//d3js.org/topojson.v2.min.js"></script>

    <link type="text/css" rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Karla|Space+Mono" rel="stylesheet">
</head>

<body>
    <!--<div id="sidebar">
        <p> This is the sidebar!</p>
    </div>-->
    <div id = "content">
    <h1> UFOs: Unsubstantiated False Observations</h1>
    <h2> by Tayyaba Arshad, Chris Huber, and Shiva Lakshmanan</h2>
   
    <p>UFOs (Unidentified Flying Objects) are constantly referenced as proof that alien life is out there. But are the sightings for real? Using data from National UFO Reporting Center, we argue that UFO sightings are mistakes and fakes. </p>
    <svg id="hist_svg" width="700" height="450">
    </svg>
        
    <h3>Testing coordinates on world map</h3>

    <svg id = "map_svg" height="700" width="1400">
    </svg>
        
    <!--Tron    Orange: #DF740C,TronYellow: #FFE64D,White: #E6FFFF,TronBlue: #6FC3DF,black: #0C141F,-->
    <script>
        
    var barColor = "#6FC3DF";
    var lineColor = "#DF740C";
    var axisColor = "#FDF6ED";
    var barOpacity = .7;
        
    var svg = d3.select("#hist_svg");
    var UFOdata;
    var bins;
    var x = d3.scaleTime()
    .domain([1970, 2013])
    .range([0,430]);
    
    
    var y = d3.scaleLinear()
    .domain([0,7357])
    .range([0,360]);
    
    var histogram = d3.histogram()
    .value(function(d) { return d.datetime; })
    .domain(x.domain())
    .thresholds(x.ticks(43));
    
    var xScale = d3.scaleLinear()
    .domain([1970,2013])
    .range([5,435]);
        
    var yScale = d3.scaleLinear()
    .domain([48238800,287885038])
    .range([360,0]);
    
    var yScale_for_axis = d3.scaleLinear()
    .domain([0,7357])
    .range([360,0]);
    
    var yAxisLeft = d3.axisLeft(yScale)
    .ticks(7);
    
    svg.append("g")
      .style("opacity", 1.0)
      .attr("stroke", lineColor)
      .attr("class", "axis")
      .call(yAxisLeft);
    d3.csv("scrubbed.csv", function(error, data) {
        if (error) throw error;
        data.forEach(function (d) {
            var date = d.datetime.split("/");
            date = date[2]; //date with year and military time
            date = Number(date.substring(0,4)); //extract year
            d.datetime = date;
            });
    function filterFunction(d) {return d.datetime >= 1970 && d.datetime < 2014;} //cut off data at 1970
    var newData = data.filter(filterFunction);
    UFOdata = newData;
    bins = histogram(UFOdata);
    
    bins.forEach(function (d,i) {
        svg.append("rect")
        .attr("x", 10*i)
        .attr("y", 360-y(d.length)+4)
        .attr("width", 10)
        .attr("height", y(d.length))
        .style("opacity", barOpacity)
        .style("stroke", "black")
        .attr("fill", barColor);
        if (d.length == 7357) {
        svg.append("text") //plot the max value(height) of the histogram bar
        .attr("x", 5+(10*i))
        .attr("y", 350-y(d.length))
        .style("text-anchor", "middle")
        .style("alignment-baseline", "central")
        .text(d.length)
        .attr("font-size", 16)
        .attr("fill", barColor);
        }
        if (d.length == 130) {
            svg.append("text") //plot the min value(height) of the histogram bar
                .attr("x", 5+(10*i))
                .attr("y", 325-y(d.length))
                .style("text-anchor", "middle")
                .style("alignment-baseline", "central")
                .text(d.length)
                .attr("font-size", 16)
                .attr("fill", barColor);

            //add reference line
            svg.append("line")
                .attr("x1", 5+(10*i))
                .attr("y1", 360-y(d.length))
                .attr("x2", 5+(10*i))
                .attr("y2", 335-y(d.length))
                .attr("stroke", barColor);
        
        }
    });
    for (var i = 0; i < 5; i++) {
    svg.append("text")
    .attr("x", 5+(100*i))
    .attr("y", 378)
    .style("text-anchor", "middle")
    .style("alignment-baseline", "central")
    .text(1970+(10*i))
    .attr("font-size", 9);
    svg.append("line")
    .attr("x1", 5+(100*i))
    .attr("y1", 365)
    .attr("x2", 5+(100*i))
    .attr("y2", 370)
    .attr("stroke", axisColor)
    .attr("stroke-width", 2);
    }
    svg.append("line")
    .attr("x1", 0)
    .attr("y1", 365)
    .attr("x2", 440)
    .attr("y2", 365)
    .attr("stroke", axisColor)
    .attr("stroke-width", 1.5);
    
    svg.append("rect")
    .attr("x", 0)
    .attr("y", 0)
    .attr("width", 40)
    .attr("height", 20)
    .attr("fill", barColor)
    .attr("stroke", "grey")
    .style("opacity", barOpacity);
    
    svg.append("text")
    .attr("id", "histogram_title")
    .attr("x", 80)
    .attr("y", 10)
    .style("text-anchor", "middle")
    .style("alignment-baseline", "central")
    .text("# of UFO Sightings")
    .attr("font-size", 7);
    
    svg.append("text")
    .attr("id", "histogram_title")
    .attr("x", 80)
    .attr("y", 17)
    .style("text-anchor", "middle")
    .style("alignment-baseline", "central")
    .text("Per Year")
    .attr("font-size", 7);
    
    svg.append("line")
    .attr("x1", 0)
    .attr("y1", 30)
    .attr("x2", 40)
    .attr("y2", 30)
    .attr("stroke", lineColor)
    .style("opacity", 0.7);
    
    svg.append("text")
    .attr("id", "linegraph_title")
    .attr("x", 80)
    .attr("y", 30)
    .style("text-anchor", "middle")
    .style("alignment-baseline", "central")
    .text("# of Plane Departures")
    .attr("font-size", 7);
    
    svg.append("text")
    .attr("id", "linegraph_title")
    .attr("x", 80)
    .attr("y", 37)
    .style("text-anchor", "middle")
    .style("alignment-baseline", "central")
    .text("Per Year")
    .attr("font-size", 7);
    
    var everything = d3.selectAll("svg > *");
    everything.attr("transform", "translate(100,20)");
    
    svg.append("g")
    .attr("stroke", barColor)
    .style("opacity", 1.0)
    .attr("transform", "translate(540,25)")
    .call(d3.axisRight(yScale_for_axis));
    
    svg.append("text")
    .text("UFO sightings vs Planes in the air")
    .attr("x", 240)
    .attr("y", 50)
    .attr("font-size", 15);
    
    });
        
    var flightsData;
    
    d3.csv("flights_by_year.csv", function(error, data) {
        if (error) throw error;
        function filterFunction(d) {return d.Year >= 1970 && d.Year < 2014;} //cut off data at 1970 and at 2013
        var temp = data.filter(filterFunction);
        flightsData = temp;
        var lineColor = "#DF740C";
        flightsData.forEach(function (d,i) {
            if (i+1 != flightsData.length) {
            svg.append("line")
            .attr("x1", xScale(d.Year))
            .attr("y1", yScale(d.totalFlights))
            .attr("x2", xScale(data[i+1].Year))
            .attr("y2", yScale(data[i+1].totalFlights))
            .attr("stroke", lineColor)
            .style("opacity", 1.0)
            .attr("stroke-width", 3);
                
            }
        });
    });
    

    </script>
        
    <script>
    var svg2 = d3.select("#map_svg");
    var projection = d3.geoEquirectangular().scale(75)
    //var projection = d3.geoConicConformal().scale(3000);
    var pathGenerator = d3.geoPath().projection(projection);

    var rawData;
    var countries;
    var ufoPoints = [];
    var airportPoints = [];

    var parseRow = function(row) {
    return row;
    }

    var parseRowToo = function(row) {
    return row;
    }

    d3.queue()
    .defer(d3.json, "world-50m.json")
    .defer(d3.csv, "ufo_sample.csv", parseRow)
    .defer(d3.csv, "Locations.csv", parseRowToo)
    .await(callback);

    function callback(error, rawMap, rawScrubbed, rawAirports) {
    rawData = rawScrubbed;


    console.log("Code in the call-back function is only executed when the data file loads.");

    //map features
    countries = topojson.feature(rawMap, rawMap.objects.countries);


    // Remember that Longitude is X! We usually 
    // write coordinates as lat/long, but always
    // flip them for plotting.
    rawData.forEach( function(d,i) {
        var long = Number(d.longitude);
        var lat = Number(d.latitude);

        ufoPoints.push([long, lat]) 
    });

    rawAirports.forEach( function(d,i) {
        var long = Number(d.Longitude);
        var lat = Number(d.Latitude);

        airportPoints.push([long, lat]) 
    });

    /*https://blog.mariusschulz.com/2016/07/16/removing-elements-from-javascript-arrays*/
    function remove(array,index) {

    if (index !== -1) {
        array.splice(index, 1);
    }
    remove(ufoPoints, 43782);

    /*ufoPoints.forEach(function(d,i)
          { if( isNaN(Number(d[1])) ){
              console.log(i);
              console.log(ufoPoints[i][1]); } 
            });*/


    }
    showMap();
    };




    function showMap() {
    // Create or modify paths for each country

    // This is like the "range" function
    //  in a linear scale.
    projection.fitExtent([[0,0], [svg2.attr("width"), svg2.attr("height")]], countries);

    // This function is like our line
    //  generator function, but it knows
    //  about projections.
    pathGenerator = d3.geoPath().projection(projection);

    // Step 1: grab all existing paths
    var paths = svg2.selectAll("path.country")
    .data(countries.features);
    //console.log(paths.size());

    // Step 2: add any additional paths, 
    //  and merge them with the existing paths
    paths = paths.enter().append("path")
    .attr("class", "country").merge(paths);
    //console.log(paths.size());

    // Update the path coordinates.
    paths.attr("d", function (country) {
    return pathGenerator(country);
    });

    // Again! Step 1: grab all existing
    //  circles.
    var testing_points = [[0,0],[30,20], [-30,-20]]
    var circles = svg2.selectAll("circle")
    .data(ufoPoints);

    // Step 2: remove unneeded circles if any
    circles.exit().remove();

    // Step 3: add additional circles if needed
    circles = circles.enter().append("circle")
    .attr("r", 1.4).merge(circles);

    // Reset the aesthetic properties.
    circles
    .attr("cx", function (d) {
    return projection(d)[0];
    })
    .attr("cy", function (d) {
    return projection(d)[1];
    })
    .style("opacity", 0.7)
    .attr("fill", "#A2CC3E" );

    circles = circles.enter().append("circle")
    .attr("r", 1.4).merge(circles)
    .data(airportPoints)
    .attr("r", 2)
    .style("opacity", .6)
    .attr("fill", "red" )
    .attr("cx", function (d) {
    return projection(d)[0];
    })
    .attr("cy", function (d) {
    return projection(d)[1];
    });

    svg2.append("text")
    .attr("x", 20)
    .attr("y", 550)
    .text("Each green circle represents one UFO sighting")
    .attr("fill", "#A2CC3E");


    }


    console.log("Code after the d3.json() call is executed immediately.");

    </script>
    </div><!--eND OF CONTENT DIV-->
</body>
</html>
